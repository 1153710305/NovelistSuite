# InkFlow å‰åç«¯åˆ†ç¦»æ¶æ„ä½¿ç”¨æŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨å¯åŠ¨å¹¶éªŒè¯ InkFlow çš„æ–°åç«¯æ¶æ„ã€‚

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿æ‚¨å·²å®‰è£… Node.js (v18+)ã€‚

### 2. å¯åŠ¨åç«¯æœåŠ¡å™¨

åç«¯æœåŠ¡å™¨è´Ÿè´£å¤„ç† AI è¯·æ±‚ã€ç®¡ç† API Keys å’Œä»»åŠ¡é˜Ÿåˆ—ã€‚

1. è¿›å…¥ server ç›®å½•ï¼š
   ```bash
   cd server
   ```

2. å®‰è£…ä¾èµ–ï¼ˆå¦‚æœå°šæœªå®‰è£…ï¼‰ï¼š
   ```bash
   npm install
   ```

3. é…ç½®ç¯å¢ƒå˜é‡ï¼š
   å¤åˆ¶ `.env.example` ä¸º `.env`ï¼Œå¹¶å¡«å…¥æ‚¨çš„ Gemini API Keysã€‚
   ```bash
   cp .env.example .env
   # ç¼–è¾‘ .env æ–‡ä»¶
   # GEMINI_API_KEYS=key1,key2,key3
   ```

4. å¯åŠ¨æœåŠ¡å™¨ï¼š
   ```bash
   # å¼€å‘æ¨¡å¼
   npm run dev
   
   # æˆ–ç›´æ¥è¿è¡Œ
   node src/index.js
   ```
   
   æˆåŠŸå¯åŠ¨åï¼Œæ‚¨åº”è¯¥çœ‹åˆ°ï¼š
   ```
   ğŸš€ InkFlow Server å¯åŠ¨æˆåŠŸï¼
   ğŸ“ æœåŠ¡åœ°å€: http://localhost:3001
   ```

### 3. é…ç½®å‰ç«¯

å‰ç«¯éœ€è¦çŸ¥é“åç«¯æœåŠ¡å™¨çš„åœ°å€ã€‚

1. åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼ˆ`NovelistSuite/`ï¼‰ï¼Œç¡®ä¿ `.env` æ–‡ä»¶åŒ…å«ä»¥ä¸‹é…ç½®ï¼š
   ```bash
   NEXT_PUBLIC_BACKEND_URL=http://localhost:3001
   NEXT_PUBLIC_USE_BACKEND=true
   ```

2. å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨ï¼š
   ```bash
   npm run dev
   ```

### 4. éªŒè¯åŠŸèƒ½

ç°åœ¨ï¼Œå‰ç«¯çš„ **Workflow (å·¥ä½œæµ)** é¡µé¢å·²åˆ‡æ¢åˆ°ä½¿ç”¨åç«¯ APIã€‚

1. æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:3000/workflow`ã€‚
2. è¾“å…¥ä¸€ä¸ªåˆ›æ„ï¼ˆä¾‹å¦‚ï¼š"èµ›åšæœ‹å…‹ä¸–ç•Œçš„ä¿®ä»™è€…"ï¼‰ã€‚
3. ç‚¹å‡» "Start Automation"ã€‚
4. è§‚å¯Ÿï¼š
   - **å‰ç«¯æ§åˆ¶å°**ï¼šåº”æ˜¾ç¤º `[GeminiAdapter] æ¨¡å¼: åç«¯API`ã€‚
   - **åç«¯æ§åˆ¶å°**ï¼šåº”æ˜¾ç¤ºä»»åŠ¡åˆ›å»ºå’Œæ‰§è¡Œçš„æ—¥å¿—ã€‚
   - **Network é¢æ¿**ï¼šåº”çœ‹åˆ°å¯¹ `http://localhost:3001/api/generate/...` çš„è¯·æ±‚ã€‚

## ğŸ› ï¸ æ¶æ„è¯´æ˜

### æ··åˆæ¨¡å¼ (Hybrid Mode)

ä¸ºäº†å¹³æ»‘è¿‡æ¸¡ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†æ··åˆæ¨¡å¼ï¼š

- **å·²è¿ç§»åŠŸèƒ½**ï¼ˆèµ°åç«¯ï¼‰ï¼š
  - æ¯æ—¥çµæ„Ÿç”Ÿæˆ (`generateDailyStories`)
  - å°è¯´æ¶æ„ç”Ÿæˆ (`generateNovelArchitecture`)
  - ç« èŠ‚å†…å®¹ç”Ÿæˆ (`generateChapterContent`)

- **æœªè¿ç§»åŠŸèƒ½**ï¼ˆä»èµ°å‰ç«¯ï¼‰ï¼š
  - é‡ç»˜æ€ç»´å¯¼å›¾ (`regenerateSingleMap`)
  - èŠ‚ç‚¹æ‰©å±• (`expandNode`)
  - èŠå¤© (`streamChatResponse`)

### è‡ªåŠ¨å›é€€ (Auto Fallback)

å¦‚æœåç«¯æœåŠ¡å™¨ä¸å¯ç”¨æˆ–è¯·æ±‚å¤±è´¥ï¼Œé€‚é…å™¨ä¼šè‡ªåŠ¨å›é€€åˆ°å‰ç«¯ç›´æ¥è°ƒç”¨æ¨¡å¼ï¼Œç¡®ä¿ç”¨æˆ·ä½“éªŒä¸å—å½±å“ã€‚

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

### åç«¯ API æµ‹è¯•

æ‚¨å¯ä»¥ä½¿ç”¨ curl ç›´æ¥æµ‹è¯•åç«¯ APIï¼š

```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:3001/health

# æŸ¥çœ‹ä»»åŠ¡é˜Ÿåˆ—çŠ¶æ€
curl http://localhost:3001/api/tasks/queue/status

# ç”Ÿæˆæ¯æ—¥çµæ„Ÿæµ‹è¯•
curl -X POST http://localhost:3001/api/generate/daily-stories \
  -H "Content-Type: application/json" \
  -d '{
    "trendFocus": "æµ‹è¯•ä¸»é¢˜",
    "targetAudience": "male",
    "model": "gemini-2.0-flash-exp"
  }'
```

### ç®¡ç† API Keys

```bash
# æŸ¥çœ‹æ‰€æœ‰ Keys
curl http://localhost:3001/admin/api-keys

# æ·»åŠ æ–° Key
curl -X POST http://localhost:3001/admin/api-keys \
  -H "Content-Type: application/json" \
  -d '{"key": "new-api-key"}'
```

## ğŸ“ ç›®å½•ç»“æ„

```
NovelistSuite/
â”œâ”€â”€ server/                 # åç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ services/       # ä¸šåŠ¡é€»è¾‘ (GeminiService, TaskQueue)
â”‚   â”‚   â”œâ”€â”€ routes/         # API è·¯ç”±
â”‚   â”‚   â””â”€â”€ models/         # æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ data/               # æ•°æ®å­˜å‚¨ (inkflow.json)
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ backendApi.ts       # å‰ç«¯ API å®¢æˆ·ç«¯
â”‚   â””â”€â”€ geminiServiceAdapter.ts # æœåŠ¡é€‚é…å™¨
â””â”€â”€ pages/
    â””â”€â”€ Workflow.tsx        # å·²è¿ç§»çš„é¡µé¢ç¤ºä¾‹
```
