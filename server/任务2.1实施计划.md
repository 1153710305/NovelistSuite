# ä»»åŠ¡ 2.1 å®æ–½è®¡åˆ’ï¼šè¿ç§»GeminiåŸºç¡€æœåŠ¡

## ğŸ“‹ è¿ç§»ç­–ç•¥

ç”±äºå‰ç«¯ geminiService.ts æœ‰ 1787 è¡Œï¼ŒåŒ…å« 42 ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬é‡‡ç”¨**æ¸è¿›å¼è¿ç§»**ç­–ç•¥ã€‚

### ä¼˜å…ˆçº§åˆ’åˆ†

#### ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼ˆç«‹å³è¿ç§»ï¼‰
1. **åŸºç¡€å·¥å…·å‡½æ•°**
   - cleanJson - JSONæ¸…æ´—
   - truncateContext - ä¸Šä¸‹æ–‡æˆªæ–­
   - extractMetrics - æ€§èƒ½æŒ‡æ ‡æå–
   - retryWithBackoff - é‡è¯•æœºåˆ¶
   - handleGeminiError - é”™è¯¯å¤„ç†

2. **æ ¸å¿ƒç”ŸæˆåŠŸèƒ½**
   - generateDailyStories - æ¯æ—¥çµæ„Ÿ
   - generateNovelArchitecture - å°è¯´æ¶æ„
   - generateChapterContent - ç« èŠ‚å†…å®¹
   - regenerateSingleMap - é‡ç»˜æ€ç»´å¯¼å›¾

#### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼ˆç¬¬äºŒæ‰¹ï¼‰
3. **ä¸Šä¸‹æ–‡å¤„ç†**
   - optimizeContextWithAI - AIä¸Šä¸‹æ–‡æ¸…æ´—
   - extractContextFromTree - ä¸Šä¸‹æ–‡æå–

4. **æ–‡æœ¬æ“ä½œ**
   - manipulateText - æ–‡æœ¬æ”¹å†™/æ¶¦è‰²
   - rewriteChapterWithContext - å¸¦ä¸Šä¸‹æ–‡é‡å†™

#### ğŸŸ¢ ä½ä¼˜å…ˆçº§ï¼ˆå¯é€‰ï¼‰
5. **é«˜çº§åŠŸèƒ½**
   - analyzeTrendKeywords - è¶‹åŠ¿åˆ†æï¼ˆéœ€è¦ Google Searchï¼‰
   - generateEmbedding - å‘é‡åŒ–ï¼ˆéœ€è¦æœ¬åœ°æ¨¡å‹ï¼‰
   - retrieveRelevantContext - RAGæ£€ç´¢ï¼ˆéœ€è¦å‘é‡åŒ–ï¼‰

### å®æ–½æ­¥éª¤

**æ­¥éª¤ 1**: åˆ›å»ºå¢å¼ºç‰ˆ GeminiServiceï¼ˆåç«¯ï¼‰
- è¿ç§»åŸºç¡€å·¥å…·å‡½æ•°
- æ”¹è¿›é”™è¯¯å¤„ç†
- æ·»åŠ é‡è¯•æœºåˆ¶

**æ­¥éª¤ 2**: è¿ç§»æ ¸å¿ƒç”ŸæˆåŠŸèƒ½
- å®Œæ•´çš„ generateDailyStories
- å®Œæ•´çš„ generateNovelArchitecture
- å®Œæ•´çš„ generateChapterContent
- å®Œæ•´çš„ regenerateSingleMap

**æ­¥éª¤ 3**: æµ‹è¯•éªŒè¯
- å•å…ƒæµ‹è¯•
- é›†æˆæµ‹è¯•
- æ€§èƒ½æµ‹è¯•

## ğŸ“ æ³¨æ„äº‹é¡¹

### éœ€è¦è°ƒæ•´çš„éƒ¨åˆ†

1. **å¯¼å…¥æ–¹å¼**
   - å‰ç«¯: `import { GoogleGenAI } from "@google/genai"`
   - åç«¯: `const { GoogleGenerativeAI } = require('@google/generative-ai')`

2. **ç±»å‹ç³»ç»Ÿ**
   - å‰ç«¯: TypeScript ç±»å‹
   - åç«¯: JSDoc æ³¨é‡Š

3. **æç¤ºè¯ç®¡ç†**
   - å‰ç«¯: ä» `prompts.ts` å¯¼å…¥
   - åç«¯: éœ€è¦åˆ›å»º `prompts.js` æˆ–å†…è”

4. **ç¯å¢ƒå·®å¼‚**
   - å‰ç«¯: æµè§ˆå™¨ç¯å¢ƒ
   - åç«¯: Node.js ç¯å¢ƒ
   - æ— æ³•ä½¿ç”¨: `@xenova/transformers`ï¼ˆæµè§ˆå™¨ä¸“ç”¨ï¼‰

### æš‚ä¸è¿ç§»çš„åŠŸèƒ½

- âŒ **æœ¬åœ° Embedding**: éœ€è¦æµè§ˆå™¨çš„ transformers.js
- âŒ **Google Search**: å‰ç«¯ä½¿ç”¨ groundingï¼Œåç«¯éœ€è¦ä¸åŒå®ç°
- âŒ **å›¾åƒç”Ÿæˆ**: Imagen APIï¼ˆå¯åç»­æ·»åŠ ï¼‰

## ğŸ¯ æœ¬æ¬¡ä»»åŠ¡ç›®æ ‡

åˆ›å»ºå¢å¼ºç‰ˆ GeminiService.jsï¼ŒåŒ…å«ï¼š
- âœ… å®Œæ•´çš„å·¥å…·å‡½æ•°
- âœ… å®Œæ•´çš„æ ¸å¿ƒç”ŸæˆåŠŸèƒ½
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œé‡è¯•
- âœ… æ€§èƒ½æŒ‡æ ‡è¿½è¸ª
