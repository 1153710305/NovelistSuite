# InkFlow Server

InkFlow AI å°è¯´åˆ›ä½œåŠ©æ‰‹çš„åç«¯æœåŠ¡ï¼Œæä¾› AI ç”Ÿæˆã€ä»»åŠ¡è°ƒåº¦å’Œ API Key ç®¡ç†åŠŸèƒ½ã€‚

## ğŸŒŸ åŠŸèƒ½ç‰¹æ€§

- **API Key å®‰å…¨ç®¡ç†**: åç«¯å­˜å‚¨ API Keyï¼Œå‰ç«¯å®Œå…¨éš”ç¦»ï¼Œæ”¯æŒå¤š Key è½®æ¢å’Œè‡ªåŠ¨æ•…éšœéš”ç¦»ã€‚
- **ä»»åŠ¡é˜Ÿåˆ—ç³»ç»Ÿ**: æ”¯æŒå¹¶å‘æ§åˆ¶ã€ä»»åŠ¡ä¼˜å…ˆçº§ã€è‡ªåŠ¨é‡è¯•å’Œè¶…æ—¶ä¿æŠ¤ã€‚
- **AI ç”ŸæˆæœåŠ¡**: å°è£… Gemini APIï¼Œæä¾›å°è¯´æ¶æ„ã€ç« èŠ‚å†…å®¹ã€æ€ç»´å¯¼å›¾ç­‰ç”ŸæˆåŠŸèƒ½ã€‚
- **ç®¡ç†åå° API**: æä¾›ä»»åŠ¡ç›‘æ§ã€Key ç®¡ç†ã€ç³»ç»Ÿé…ç½®ç­‰ç®¡ç†æ¥å£ã€‚
- **æ•°æ®æŒä¹…åŒ–**: åŸºäº JSON æ–‡ä»¶çš„è½»é‡çº§æ•°æ®åº“ï¼Œæ”¯æŒä»»åŠ¡æ—¥å¿—è®°å½•ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
cd server
npm install
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ `.env.example` ä¸º `.env`ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```env
PORT=3001
GEMINI_API_KEYS=["key1", "key2", "key3"]
```

### 3. å¯åŠ¨æœåŠ¡å™¨

å¼€å‘æ¨¡å¼ï¼ˆè‡ªåŠ¨é‡å¯ï¼‰ï¼š

```bash
npm run dev
```

ç”Ÿäº§æ¨¡å¼ï¼š

```bash
npm start
```

## ğŸ“š API æ–‡æ¡£

### åŸºç¡€æ¥å£

- `GET /health`: å¥åº·æ£€æŸ¥
- `GET /api/info`: API ä¿¡æ¯

### ä»»åŠ¡ç®¡ç† (`/api/tasks`)

- `POST /`: åˆ›å»ºä»»åŠ¡
- `GET /`: è·å–ä»»åŠ¡åˆ—è¡¨
- `GET /:id`: è·å–ä»»åŠ¡è¯¦æƒ…
- `GET /:id/logs`: è·å–ä»»åŠ¡æ—¥å¿—
- `DELETE /:id`: å–æ¶ˆ/åˆ é™¤ä»»åŠ¡
- `GET /stats`: è·å–ä»»åŠ¡ç»Ÿè®¡
- `GET /queue/status`: è·å–é˜Ÿåˆ—çŠ¶æ€
- `POST /queue/config`: é…ç½®é˜Ÿåˆ—å‚æ•°

### AI ç”Ÿæˆ (`/api/generate`)

- `POST /daily-stories`: ç”Ÿæˆæ¯æ—¥çµæ„Ÿ
- `POST /novel-architecture`: ç”Ÿæˆå°è¯´æ¶æ„
- `POST /chapter-content`: ç”Ÿæˆç« èŠ‚å†…å®¹
- `POST /regenerate-map`: é‡ç»˜æ€ç»´å¯¼å›¾
- `POST /expand-node`: æ‰©å±•èŠ‚ç‚¹
- `POST /manipulate-text`: æ–‡æœ¬æ¶¦è‰²/ç»­å†™
- `POST /rewrite-chapter`: ç« èŠ‚é‡å†™
- `POST /analyze-trend`: è¶‹åŠ¿åˆ†æ

### ç®¡ç†å‘˜æ¥å£ (`/api/admin`)

- `GET /api-keys`: è·å– API Key åˆ—è¡¨
- `POST /api-keys`: æ·»åŠ  API Key
- `DELETE /api-keys/:id`: åˆ é™¤ API Key
- `PUT /api-keys/:id/reactivate`: é‡æ–°å¯ç”¨ Key

## ğŸ› ï¸ ç›®å½•ç»“æ„

```
server/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.js           # å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ config.js          # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ routes/            # è·¯ç”±å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ admin.js       # ç®¡ç†å‘˜è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ generate.js    # ç”Ÿæˆè·¯ç”±
â”‚   â”‚   â””â”€â”€ tasks.js       # ä»»åŠ¡è·¯ç”±
â”‚   â”œâ”€â”€ services/          # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ ApiKeyManager.js # Key ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ GeminiService.js # AI æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ PromptService.js # æç¤ºè¯æœåŠ¡
â”‚   â”‚   â””â”€â”€ TaskQueue.js     # ä»»åŠ¡é˜Ÿåˆ—
â”‚   â”œâ”€â”€ models/            # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ Task.js        # ä»»åŠ¡æ¨¡å‹
â”‚   â”‚   â””â”€â”€ index.js       # æ•°æ®åº“åˆå§‹åŒ–
â”‚   â””â”€â”€ utils/             # å·¥å…·å‡½æ•°
â”œâ”€â”€ data/                  # æ•°æ®å­˜å‚¨
â””â”€â”€ test-e2e.js            # é›†æˆæµ‹è¯•è„šæœ¬
```

## ğŸ§ª æµ‹è¯•

è¿è¡Œç«¯åˆ°ç«¯é›†æˆæµ‹è¯•ï¼š

```bash
node test-e2e.js
```

## ğŸ³ Docker éƒ¨ç½²

æ„å»ºé•œåƒï¼š

```bash
docker build -t inkflow-server .
```

è¿è¡Œå®¹å™¨ï¼š

```bash
docker run -d -p 3001:3001 --env-file .env inkflow-server
```
