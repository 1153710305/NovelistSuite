# InkFlow 后端管理系统使用指南

## 🚀 快速开始

### 启动服务

1. **启动后端服务器**
   ```bash
   cd server
   npm run dev
   ```

2. **访问后端管理界面**
   打开浏览器访问：http://localhost:3001/admin

## 📋 功能概览

### 后端监控 (Backend Monitor)
- **实时统计**
  - 队列长度：当前等待处理的任务数
  - 运行中任务：正在执行的任务数
  - 今日完成：今天完成的任务总数
  - 今日失败：今天失败的任务总数

- **任务列表**
  - 显示最近 20 个任务
  - 查看任务详细信息（ID、类型、状态、创建时间、耗时）
  - 查看任务日志
  - 取消运行中的任务

- **自动刷新**
  - 默认每 5 秒自动刷新数据
  - 可手动关闭自动刷新

### API Keys 管理
- **添加 API Key**
  - 输入新的 Gemini API Key
  - 点击"添加 Key"按钮即可添加

- **查看 API Keys**
  - Key ID：API Key 的唯一标识
  - 状态：激活/已禁用
  - 使用次数：该 Key 被使用的总次数
  - 失败次数：使用该 Key 失败的次数
  - 最后使用：最后一次使用该 Key 的时间

- **管理 API Keys**
  - 重新激活：重新启用被禁用的 Key
  - 删除 Key：从系统中删除该 Key

- **自动轮换机制**
  - 系统使用最近最少使用 (LRU) 策略自动轮换 API Keys
  - 如果某个 Key 失败次数过多，将被自动禁用
  - 可以手动重新激活被禁用的 Key

## 🌐 语言切换

- 支持中文和英文两种语言
- 点击右上角的语言选择器即可切换
- 语言设置会实时应用到整个界面

## 📊 监控建议

### 正常运行指标
- 队列长度 < 10
- 运行中任务 ≤ 最大并发数（默认 3）
- 失败次数 < 5%

### 异常情况处理
- **队列过长**：考虑增加并发数或检查任务是否卡住
- **任务频繁失败**：检查 API Key 是否有效或额度是否用尽
- **API Key 被禁用**：查看失败原因，解决后重新激活

## 🔧 故障排查

### 页面无法访问
1. 确认后端服务器正在运行：`cd server && npm run dev`
2. 检查端口 3001 是否被占用
3. 查看服务器日志是否有错误信息

### 数据不显示
1. 检查浏览器控制台是否有错误
2. 确认后端 API 正常运行：访问 http://localhost:3001/health
3. 刷新页面重试

### 操作失败
1. 查看任务日志了解具体错误原因
2. 检查 API Key 是否有效
3. 确认网络连接正常

## 📝 API 端点

后端管理界面使用以下 API：

- `GET /api/tasks/stats` - 获取任务统计
- `GET /api/tasks/queue/status` - 获取队列状态
- `GET /api/tasks?limit=20` - 获取任务列表
- `GET /api/tasks/:id/logs` - 获取任务日志
- `DELETE /api/tasks/:id` - 取消任务
- `GET /api/admin/api-keys` - 获取 API Keys 列表
- `POST /api/admin/api-keys` - 添加 API Key
- `PUT /api/admin/api-keys/:id/reactivate` - 重新激活 Key
- `DELETE /api/admin/api-keys/:id` - 删除 Key

## 🔒 安全建议

1. **仅在内网使用**：后端管理界面不应暴露到公网
2. **添加认证**：生产环境建议添加登录认证
3. **定期检查**：定期查看 API Keys 使用情况
4. **备份密钥**：保存 API Keys 的备份

## 💡 使用技巧

1. **快速定位问题**：使用任务日志功能查看详细错误信息
2. **优化性能**：根据监控数据调整最大并发数
3. **管理密钥**：定期检查并禁用不再使用的 API Keys
4. **批量操作**：使用自动刷新功能实时监控任务执行情况

## 📞 支持

如有问题或建议，请联系技术支持团队。
